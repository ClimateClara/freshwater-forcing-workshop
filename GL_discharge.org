
#+PROPERTY: header-args:jupyter-python+ :dir (file-name-directory buffer-file-name) :session mankoff_2020_solid

* Table of contents                               :toc_3:noexport:
- [[#introduction][Introduction]]
  - [[#warning][WARNING]]
  - [[#data-example][Data example]]
    - [[#printout][Printout]]
    - [[#plot-annual-discharge-per-region][Plot: Annual discharge per region]]
    - [[#table-annual-discharge-per-region][Table: Annual discharge per region]]
- [[#fetch-data][Fetch data]]
- [[#reprocess][Reprocess]]

* Introduction

Greenland discharge is repackaged from:
+ Paper: Mankoff (2020) http://doi.org/10.5194/essd-12-1367-2020 
+ Code (original): https://github.com/GEUS-Glaciology-and-Climate/ice_discharge
+ Data: https://doi.org/10.22008/promice/data/ice_discharge/d/v02

** WARNING

This product is generated from flux gates ~5 km upstream of the terminus.

It lacks
+ Terminus retreat, which should add ~10 % over the last two decades
  + Greene (2024) http://doi.org/10.1038/s41586-023-06863-2
  + Kochtitzky (2023) http://doi.org/10.1029/2023gl104095 
+ Splitting output between icebergs and submarine melt, which is ~50 % +- 40 %
  + Enderlin (2013) http://doi.org/10.3189/2013JoG12J049 

** Data example

*** Printout

#+BEGIN_SRC jupyter-python :exports results :prologue "import xarray as xr" :display text/plain
xr.open_dataset('./dat/GL_discharge.nc')
#+END_SRC

#+RESULTS:
#+begin_example
<xarray.Dataset> Size: 12kB
Dimensions:      (region: 7, time: 185)
Coordinates:
  ,* time         (time) datetime64[ns] 1kB 1840-01-01 1841-01-01 ... 2024-01-01
  ,* region       (region) int32 28B 1 2 3 4 5 6 7
Data variables:
    discharge    (region, time) float32 5kB ...
    err          (region, time) float32 5kB ...
    region_name  (region) <U2 56B ...
Attributes: (12/14)
    featureType:      timeSeries
    title:            Greenland ice sheet discharge by Mougniot region
    summary:          Greenland ice shet discharge by Mougnito region
    keywords:         Greenland; Mass; Mass balance
    source:           git commit: 20af941
    creator_name:     Ken Mankoff
    ...               ...
    institution:      NASA GISS
    references:       TBD
    product_version:  1.0
    history:          TBD
    Conventions:      CF-1.8
    DOI:              https://doi.org/10.5281/zenodo.14020895
#+end_example

*** Plot: Annual discharge per region

#+BEGIN_SRC jupyter-python :exports both :file ./fig/GL_discharge.png
import xarray as xr
ds = xr.open_dataset('dat/GL_discharge.nc')
df = ds['discharge'].to_dataframe()['discharge']

df = df.unstack().T
df.columns = ds['region_name'].values
ax = df.plot(drawstyle='steps-post')
_ = ax.set_ylabel('Discharge [Gt yr$^{-1}$]')
#+END_SRC

#+RESULTS:
[[./fig/GL_discharge.png]]

*** Table: Annual discharge per region

#+begin_src jupyter-python :exports both
import xarray as xr
ds = xr.open_dataset('dat/GL_discharge.nc')
ds = ds.sel({'time': slice('1800-01-01','2013-12-31')})
df = ds['discharge'].to_dataframe()['discharge']
df = df.unstack().T
df.columns = [str(_[0]) + ' ['+_[1]+']' for _ in zip(ds['region'].values, ds['region_name'].values)]
df['GL'] = df.sum(axis='columns')
df.index = [str(_)[0:4] for _ in df.index]
df.round()
#+end_src

#+RESULTS:
|      |   1 [CE] |   2 [CW] |   3 [NE] |   4 [NO] |   5 [NW] |   6 [SE] |   7 [SW] |   GL |
|------+----------+----------+----------+----------+----------+----------+----------+------|
| 1840 |       65 |       62 |       20 |       22 |       86 |      119 |       18 |  392 |
| 1841 |       65 |       62 |       20 |       22 |       86 |      119 |       18 |  392 |
| 1842 |       65 |       62 |       20 |       22 |       86 |      119 |       18 |  392 |
| 1843 |       65 |       62 |       20 |       22 |       86 |      119 |       18 |  392 |
| 1844 |       65 |       62 |       20 |       22 |       86 |      119 |       18 |  392 |
| 1845 |       66 |       63 |       21 |       22 |       88 |      122 |       18 |  401 |
| 1846 |       66 |       63 |       21 |       22 |       88 |      121 |       18 |  398 |
| 1847 |       66 |       63 |       21 |       22 |       88 |      121 |       18 |  399 |
| 1848 |       67 |       65 |       21 |       23 |       90 |      124 |       18 |  408 |
| 1849 |       67 |       64 |       21 |       23 |       90 |      123 |       18 |  406 |
| 1850 |       67 |       64 |       21 |       23 |       90 |      124 |       18 |  408 |
| 1851 |       66 |       63 |       21 |       22 |       88 |      122 |       18 |  401 |
| 1852 |       68 |       65 |       21 |       23 |       91 |      125 |       19 |  412 |
| 1853 |       69 |       66 |       22 |       23 |       93 |      128 |       19 |  421 |
| 1854 |       69 |       66 |       22 |       23 |       92 |      127 |       19 |  418 |
| 1855 |       69 |       66 |       22 |       23 |       92 |      126 |       19 |  416 |
| 1856 |       68 |       66 |       22 |       23 |       91 |      126 |       19 |  415 |
| 1857 |       70 |       67 |       22 |       23 |       93 |      128 |       19 |  423 |
| 1858 |       69 |       66 |       22 |       23 |       93 |      128 |       19 |  420 |
| 1859 |       68 |       65 |       22 |       23 |       91 |      126 |       19 |  413 |
| 1860 |       68 |       65 |       21 |       23 |       91 |      125 |       19 |  411 |
| 1861 |       68 |       65 |       21 |       23 |       90 |      124 |       18 |  409 |
| 1862 |       67 |       64 |       21 |       22 |       89 |      123 |       18 |  404 |
| 1863 |       64 |       61 |       20 |       22 |       86 |      118 |       17 |  388 |
| 1864 |       63 |       60 |       20 |       21 |       84 |      115 |       17 |  379 |
| 1865 |       62 |       60 |       20 |       21 |       83 |      115 |       17 |  378 |
| 1866 |       61 |       59 |       19 |       21 |       82 |      113 |       17 |  372 |
| 1867 |       63 |       60 |       20 |       21 |       84 |      115 |       17 |  380 |
| 1868 |       62 |       60 |       20 |       21 |       83 |      114 |       17 |  377 |
| 1869 |       63 |       61 |       20 |       21 |       84 |      116 |       17 |  383 |
| 1870 |       64 |       61 |       20 |       22 |       86 |      118 |       17 |  388 |
| 1871 |       66 |       63 |       21 |       22 |       88 |      121 |       18 |  398 |
| 1872 |       68 |       65 |       21 |       23 |       90 |      124 |       18 |  409 |
| 1873 |       67 |       64 |       21 |       22 |       89 |      123 |       18 |  404 |
| 1874 |       68 |       65 |       21 |       23 |       91 |      125 |       19 |  411 |
| 1875 |       68 |       65 |       21 |       23 |       91 |      125 |       18 |  411 |
| 1876 |       68 |       65 |       21 |       23 |       90 |      125 |       18 |  410 |
| 1877 |       68 |       65 |       21 |       23 |       91 |      125 |       19 |  412 |
| 1878 |       67 |       64 |       21 |       22 |       89 |      123 |       18 |  404 |
| 1879 |       67 |       64 |       21 |       23 |       90 |      124 |       18 |  408 |
| 1880 |       68 |       65 |       21 |       23 |       90 |      124 |       18 |  409 |
| 1881 |       68 |       65 |       21 |       23 |       90 |      125 |       18 |  410 |
| 1882 |       68 |       65 |       21 |       23 |       90 |      125 |       18 |  410 |
| 1883 |       67 |       64 |       21 |       22 |       89 |      123 |       18 |  405 |
| 1884 |       66 |       63 |       21 |       22 |       88 |      122 |       18 |  401 |
| 1885 |       66 |       63 |       21 |       22 |       88 |      122 |       18 |  400 |
| 1886 |       66 |       63 |       21 |       22 |       88 |      121 |       18 |  398 |
| 1887 |       66 |       63 |       21 |       22 |       88 |      121 |       18 |  398 |
| 1888 |       68 |       65 |       21 |       23 |       90 |      124 |       18 |  409 |
| 1889 |       67 |       64 |       21 |       23 |       90 |      123 |       18 |  406 |
| 1890 |       68 |       65 |       21 |       23 |       90 |      124 |       18 |  410 |
| 1891 |       68 |       65 |       22 |       23 |       91 |      126 |       19 |  413 |
| 1892 |       69 |       66 |       22 |       23 |       92 |      127 |       19 |  418 |
| 1893 |       70 |       67 |       22 |       23 |       93 |      128 |       19 |  423 |
| 1894 |       68 |       65 |       22 |       23 |       91 |      126 |       19 |  413 |
| 1895 |       69 |       66 |       22 |       23 |       92 |      126 |       19 |  416 |
| 1896 |       69 |       66 |       22 |       23 |       92 |      127 |       19 |  417 |
| 1897 |       69 |       66 |       22 |       23 |       92 |      126 |       19 |  416 |
| 1898 |       68 |       65 |       21 |       23 |       90 |      125 |       18 |  410 |
| 1899 |       67 |       65 |       21 |       23 |       90 |      124 |       18 |  409 |
| 1900 |       69 |       66 |       22 |       23 |       93 |      127 |       19 |  420 |
| 1901 |       69 |       66 |       22 |       23 |       92 |      126 |       19 |  416 |
| 1902 |       70 |       67 |       22 |       23 |       93 |      128 |       19 |  422 |
| 1903 |       70 |       67 |       22 |       23 |       93 |      128 |       19 |  421 |
| 1904 |       71 |       68 |       22 |       24 |       95 |      131 |       19 |  430 |
| 1905 |       71 |       68 |       22 |       24 |       95 |      130 |       19 |  429 |
| 1906 |       70 |       67 |       22 |       24 |       94 |      129 |       19 |  424 |
| 1907 |       71 |       68 |       22 |       24 |       95 |      130 |       19 |  429 |
| 1908 |       71 |       68 |       22 |       24 |       95 |      131 |       19 |  430 |
| 1909 |       72 |       69 |       23 |       24 |       96 |      132 |       20 |  434 |
| 1910 |       71 |       68 |       22 |       24 |       95 |      131 |       19 |  430 |
| 1911 |       71 |       68 |       22 |       24 |       95 |      131 |       19 |  432 |
| 1912 |       71 |       68 |       23 |       24 |       95 |      131 |       19 |  433 |
| 1913 |       71 |       68 |       23 |       24 |       95 |      131 |       19 |  432 |
| 1914 |       69 |       66 |       22 |       23 |       92 |      127 |       19 |  419 |
| 1915 |       69 |       66 |       22 |       23 |       92 |      127 |       19 |  419 |
| 1916 |       69 |       66 |       22 |       23 |       92 |      127 |       19 |  418 |
| 1917 |       69 |       66 |       22 |       23 |       93 |      128 |       19 |  420 |
| 1918 |       68 |       65 |       21 |       23 |       91 |      125 |       19 |  412 |
| 1919 |       67 |       64 |       21 |       23 |       90 |      124 |       18 |  408 |
| 1920 |       68 |       65 |       22 |       23 |       91 |      126 |       19 |  413 |
| 1921 |       68 |       65 |       21 |       23 |       91 |      125 |       18 |  410 |
| 1922 |       67 |       64 |       21 |       22 |       89 |      123 |       18 |  404 |
| 1923 |       67 |       64 |       21 |       23 |       89 |      123 |       18 |  406 |
| 1924 |       68 |       65 |       22 |       23 |       91 |      125 |       19 |  413 |
| 1925 |       68 |       65 |       22 |       23 |       91 |      126 |       19 |  414 |
| 1926 |       70 |       67 |       22 |       24 |       93 |      129 |       19 |  424 |
| 1927 |       71 |       68 |       22 |       24 |       95 |      131 |       19 |  431 |
| 1928 |       74 |       71 |       23 |       25 |       99 |      137 |       20 |  450 |
| 1929 |       75 |       71 |       24 |       25 |      100 |      137 |       20 |  452 |
| 1930 |       75 |       72 |       24 |       25 |      100 |      138 |       20 |  453 |
| 1931 |       78 |       75 |       25 |       26 |      104 |      144 |       21 |  473 |
| 1932 |       78 |       75 |       25 |       26 |      104 |      143 |       21 |  471 |
| 1933 |       78 |       75 |       25 |       26 |      104 |      144 |       21 |  473 |
| 1934 |       77 |       74 |       24 |       26 |      103 |      141 |       21 |  465 |
| 1935 |       77 |       74 |       24 |       26 |      103 |      142 |       21 |  467 |
| 1936 |       78 |       75 |       25 |       26 |      104 |      143 |       21 |  472 |
| 1937 |       76 |       73 |       24 |       26 |      101 |      140 |       21 |  460 |
| 1938 |       75 |       72 |       24 |       25 |      100 |      138 |       20 |  455 |
| 1939 |       75 |       72 |       24 |       25 |      101 |      139 |       21 |  457 |
| 1940 |       75 |       72 |       24 |       25 |      100 |      138 |       20 |  453 |
| 1941 |       75 |       71 |       24 |       25 |      100 |      137 |       20 |  451 |
| 1942 |       74 |       70 |       23 |       25 |       98 |      135 |       20 |  446 |
| 1943 |       73 |       70 |       23 |       25 |       98 |      135 |       20 |  445 |
| 1944 |       74 |       70 |       23 |       25 |       98 |      135 |       20 |  445 |
| 1945 |       72 |       69 |       23 |       24 |       96 |      133 |       20 |  437 |
| 1946 |       72 |       69 |       23 |       24 |       96 |      133 |       20 |  437 |
| 1947 |       72 |       69 |       23 |       24 |       96 |      132 |       20 |  433 |
| 1948 |       72 |       69 |       23 |       24 |       97 |      133 |       20 |  438 |
| 1949 |       73 |       70 |       23 |       25 |       98 |      134 |       20 |  443 |
| 1950 |       74 |       71 |       23 |       25 |       99 |      136 |       20 |  447 |
| 1951 |       75 |       71 |       24 |       25 |      100 |      137 |       20 |  452 |
| 1952 |       75 |       72 |       24 |       25 |      101 |      139 |       21 |  456 |
| 1953 |       75 |       72 |       24 |       25 |      100 |      138 |       21 |  456 |
| 1954 |       74 |       71 |       23 |       25 |       99 |      136 |       20 |  449 |
| 1955 |       73 |       70 |       23 |       24 |       97 |      134 |       20 |  440 |
| 1956 |       72 |       69 |       23 |       24 |       96 |      132 |       20 |  434 |
| 1957 |       72 |       69 |       23 |       24 |       97 |      133 |       20 |  438 |
| 1958 |       73 |       69 |       23 |       24 |       97 |      133 |       20 |  439 |
| 1959 |       72 |       69 |       23 |       24 |       97 |      133 |       20 |  438 |
| 1960 |       74 |       71 |       23 |       25 |       99 |      136 |       20 |  448 |
| 1961 |       75 |       72 |       24 |       25 |      100 |      138 |       20 |  455 |
| 1962 |       76 |       73 |       24 |       26 |      101 |      140 |       21 |  460 |
| 1963 |       74 |       71 |       23 |       25 |       99 |      137 |       20 |  450 |
| 1964 |       73 |       70 |       23 |       25 |       97 |      134 |       20 |  442 |
| 1965 |       73 |       70 |       23 |       25 |       98 |      135 |       20 |  444 |
| 1966 |       72 |       69 |       23 |       24 |       96 |      133 |       20 |  436 |
| 1967 |       71 |       68 |       23 |       24 |       95 |      131 |       19 |  432 |
| 1968 |       71 |       68 |       22 |       24 |       95 |      131 |       19 |  432 |
| 1969 |       71 |       68 |       23 |       24 |       95 |      131 |       19 |  433 |
| 1970 |       71 |       68 |       22 |       24 |       95 |      131 |       19 |  430 |
| 1971 |       71 |       68 |       22 |       24 |       95 |      130 |       19 |  430 |
| 1972 |       69 |       66 |       22 |       23 |       93 |      127 |       19 |  420 |
| 1973 |       69 |       66 |       22 |       23 |       92 |      127 |       19 |  417 |
| 1974 |       69 |       66 |       22 |       23 |       92 |      126 |       19 |  415 |
| 1975 |       69 |       66 |       22 |       23 |       92 |      127 |       19 |  417 |
| 1976 |       70 |       67 |       22 |       23 |       93 |      128 |       19 |  421 |
| 1977 |       70 |       67 |       22 |       23 |       93 |      128 |       19 |  422 |
| 1978 |       71 |       68 |       22 |       24 |       95 |      131 |       19 |  431 |
| 1979 |       72 |       69 |       23 |       24 |       96 |      132 |       20 |  434 |
| 1980 |       72 |       68 |       23 |       24 |       95 |      132 |       19 |  433 |
| 1981 |       72 |       69 |       23 |       24 |       96 |      132 |       20 |  434 |
| 1982 |       72 |       69 |       23 |       24 |       96 |      132 |       20 |  435 |
| 1983 |       70 |       67 |       22 |       24 |       94 |      129 |       19 |  426 |
| 1984 |       70 |       67 |       22 |       24 |       94 |      129 |       19 |  424 |
| 1985 |       71 |       68 |       22 |       24 |       95 |      130 |       19 |  430 |
| 1986 |       69 |       72 |       23 |       24 |       96 |      145 |       21 |  449 |
| 1987 |       70 |       71 |       23 |       24 |       93 |      146 |       20 |  448 |
| 1988 |       72 |       70 |       22 |       24 |       95 |      135 |       21 |  439 |
| 1989 |       73 |       71 |       22 |       24 |      102 |      128 |       21 |  441 |
| 1990 |       75 |       68 |       22 |       23 |      105 |      129 |       22 |  444 |
| 1991 |       75 |       68 |       23 |       23 |      100 |      130 |       22 |  442 |
| 1992 |       78 |       68 |       24 |       23 |       98 |      132 |       21 |  445 |
| 1993 |       77 |       68 |       25 |       24 |       99 |      132 |       19 |  444 |
| 1994 |       71 |       68 |       24 |       25 |       97 |      136 |       18 |  440 |
| 1995 |       66 |       65 |       22 |       26 |       94 |      135 |       18 |  427 |
| 1996 |       68 |       67 |       22 |       26 |       93 |      135 |       19 |  430 |
| 1997 |       70 |       69 |       21 |       23 |       92 |      133 |       20 |  427 |
| 1998 |       70 |       73 |       22 |       22 |       92 |      130 |       19 |  429 |
| 1999 |       70 |       74 |       22 |       26 |       91 |      132 |       18 |  434 |
| 2000 |       69 |       79 |       23 |       25 |       92 |      130 |       20 |  437 |
| 2001 |       70 |       80 |       24 |       23 |       90 |      125 |       19 |  431 |
| 2002 |       72 |       81 |       26 |       23 |       92 |      132 |       19 |  444 |
| 2003 |       75 |       83 |       25 |       23 |       94 |      138 |       19 |  458 |
| 2004 |       79 |       83 |       24 |       24 |       98 |      144 |       20 |  471 |
| 2005 |       85 |       83 |       24 |       24 |       99 |      145 |       20 |  480 |
| 2006 |       85 |       85 |       25 |       25 |       97 |      138 |       20 |  474 |
| 2007 |       81 |       85 |       24 |       26 |       97 |      135 |       19 |  467 |
| 2008 |       79 |       87 |       25 |       26 |       99 |      139 |       18 |  474 |
| 2009 |       78 |       89 |       24 |       24 |      102 |      142 |       18 |  477 |
| 2010 |       77 |       89 |       25 |       27 |      102 |      143 |       17 |  481 |
| 2011 |       79 |       89 |       26 |       25 |      106 |      142 |       19 |  487 |
| 2012 |       79 |       93 |       26 |       25 |      105 |      139 |       19 |  486 |
| 2013 |       79 |       95 |       26 |       25 |      109 |      140 |       20 |  493 |

#+begin_src jupyter-python :exports both :file ./fig/runoff_GL_month.png
df.describe().round()
#+end_src

#+RESULTS:
|       |   1 [CE] |   2 [CW] |   3 [NE] |   4 [NO] |   5 [NW] |   6 [SE] |   7 [SW] |   GL |
|-------+----------+----------+----------+----------+----------+----------+----------+------|
| count |      174 |      174 |      174 |      174 |      174 |      174 |      174 |  174 |
| mean  |       71 |       69 |       22 |       24 |       94 |      130 |       19 |  428 |
| std   |        4 |        6 |        1 |        1 |        5 |        7 |        1 |   24 |
| min   |       61 |       59 |       19 |       21 |       82 |      113 |       17 |  372 |
| 25%   |       68 |       65 |       21 |       23 |       90 |      125 |       18 |  410 |
| 50%   |       70 |       67 |       22 |       23 |       93 |      129 |       19 |  427 |
| 75%   |       73 |       70 |       23 |       24 |       97 |      135 |       20 |  444 |
| max   |       85 |       95 |       26 |       27 |      109 |      146 |       22 |  493 |

* Fetch data

#+BEGIN_SRC bash :exports both :results verbatim :wrap src json
export SERVER_URL=https://dataverse.geus.dk
export PERSISTENT_IDENTIFIER=doi:10.22008/FK2/OHI23Z
export METADATA_FORMAT=dataverse_json # ddi dataverse_json schema.org Datacite oai_datacite
curl "$SERVER_URL/api/datasets/export?exporter=$METADATA_FORMAT&persistentId=$PERSISTENT_IDENTIFIER" | jq .datasetVersion.versionNumber
#+END_SRC

#+RESULTS:
#+begin_src json
875
#+end_src

#+BEGIN_SRC bash :exports both :results verbatim
mkdir -p tmp/greenland_discharge
pushd tmp/greenland_discharge
wget -r -e robots=off -nH --cut-dirs=3 --content-disposition "https://dataverse.geus.dk/api/datasets/:persistentId/dirindex?persistentId=doi:10.22008/FK2/OHI23Z"
# wget -r -e robots=off -nH --cut-dirs=3 --content-disposition "https://dataverse.geus.dk/api/datasets/:persistentId/dirindex?persistentId=doi:10.22008/promice/data/ice_discharge/d/v02"
popd
#+END_SRC

* Reprocess

+ Annual discharge
+ Group by ROI

#+BEGIN_SRC jupyter-python :exports both
import xarray as xr
import numpy as np

ds = xr.open_dataset('./tmp/greenland_discharge/MB_region.nc')

# Limit to discharge
ds = ds[['D_ROI','D_ROI_err','D']]

# Drop partial years
this_yr = ds['time'].to_series().iloc[-1].year
ds = ds.sel({'time':slice('1800',str(this_yr))})

# Scale early values to annual
ds.loc[{'time': slice('1840-01-01','1985-12-31')}] *= 365

# Resample by year
ds = ds.resample({'time':'YS'}).sum()

# Prior to 1986 there is no regional resolution, just one value for all of Greenland.

# Split into regions by taking the 1990s percent of discharge per region, and assuming the historical GIS-wide discharge maintained that distribution (even if magnitude changed).

ds_ratio = ds['D_ROI'].loc[{'time': slice('1990-01-01','1999-12-31')}].sum(dim='time')
ds_ratio = ds_ratio / sum(ds_ratio)
# print(ds_ratio)

for r in ds['region']:
    # Set regional values to the average of the first 5 years when there is regional resolution
    ds['D_ROI'].sel({'region':r}).loc[{'time': slice('1840-01-01','1985-12-31')}] = \
        ds['D'].loc[{'time': slice('1840-01-01','1985-12-31')}] * ds_ratio.sel(region=r.values).values
    # Set regional uncertainty to the full range of observed values
    errmax = ds['D_ROI'].sel({'region':r, 'time':slice('1986-01-01','1999-12-31')}).max()
    errmin = ds['D_ROI'].sel({'region':r, 'time':slice('1986-01-01','1999-12-31')}).min()
    ds['D_ROI_err'].sel({'region':r}).loc[{'time': slice('1840-01-01','1985-12-31')}] = (errmax-errmin)

ds = ds.transpose()

ds = ds.rename({'D_ROI':'discharge','D_ROI_err':'err'})
ds = ds.drop_vars('D')

ds['discharge'].attrs['units'] = 'Gt yr-1'
ds['err'].attrs['units'] = 'Gt yr-1'

ds['discharge'].attrs['long_name'] = 'Marine discharge. Includes both calving and submarine melt. Some calvinvg is equivalent to submarine melt if using at fjord mouth'

ds = ds.sortby('region')
ds = ds.rename_dims({'region':'region_name'}).rename({'region':'region_name'})
ds['region'] = (('region_name'),np.arange(7).astype(np.int32) + 1)
ds = ds.set_coords('region')
ds = ds.swap_dims({'region_name':'region'})
ds = ds.reset_coords('region_name')

ds['discharge'].attrs['standard_name'] = 'tendency_of_land_ice_mass_due_to_calving'
ds['discharge'].attrs['units'] = 'Gt yr-1'
ds['err'].attrs['standard_name'] = 'tendency_of_land_ice_mass_due_to_calving'

ds['time'].attrs['long_name'] = 'time'
ds['region'].attrs['long_name'] = 'Mougniot (2019) region'

ds.attrs['title'] = 'Greenland ice sheet discharge by Mougniot region'
ds.attrs['history'] = 'TBD'
ds.attrs['Conventions'] = 'CF-1.8'

ds.attrs['summary'] = 'Greenland ice shet discharge by Mougnito region'
ds.attrs['creator_name'] = 'Ken Mankoff'
ds.attrs['creator_email'] = 'ken.mankoff@nasa.gov'
ds.attrs['institution'] = 'NASA GISS'
ds.attrs['references'] = 'TBD'
ds.attrs['DOI'] = 'https://doi.org/10.5281/zenodo.14020895'

comp = dict(zlib=True, complevel=5)
encoding = {} # var: comp for var in items}
encoding['time'] = {'dtype': 'i4'}

!rm ./dat/GL_discharge.nc
ds.to_netcdf('./dat/GL_discharge.nc', encoding=encoding)
!ncdump -h ./dat/GL_discharge.nc
#+END_SRC

#+RESULTS:
#+begin_example
netcdf GL_discharge {
dimensions:
	region = 7 ;
	time = 185 ;
variables:
	float discharge(region, time) ;
		discharge:_FillValue = NaNf ;
		discharge:long_name = "Marine discharge. Includes both calving and submarine melt. Some calvinvg is equivalent to submarine melt if using at fjord mouth" ;
		discharge:standard_name = "tendency_of_land_ice_mass_due_to_calving" ;
		discharge:units = "Gt yr-1" ;
	float err(region, time) ;
		err:_FillValue = NaNf ;
		err:long_name = "Marine mass balance uncertainty" ;
		err:standard_name = "tendency_of_land_ice_mass_due_to_calving" ;
		err:units = "Gt yr-1" ;
	string region_name(region) ;
		region_name:long_name = "Mouginot 2019 regions" ;
	int time(time) ;
		time:long_name = "time" ;
		time:units = "days since 1840-01-01 00:00:00" ;
		time:calendar = "proleptic_gregorian" ;
	int region(region) ;
		region:long_name = "Mougniot (2019) region" ;

// global attributes:
		:featureType = "timeSeries" ;
		:title = "Greenland ice sheet discharge by Mougniot region" ;
		:summary = "Greenland ice shet discharge by Mougnito region" ;
		:keywords = "Greenland; Mass; Mass balance" ;
		:source = "git commit: 20af941" ;
		:creator_name = "Ken Mankoff" ;
		:creator_email = "ken.mankoff@nasa.gov" ;
		:creator_url = "http://kenmankoff.com" ;
		:institution = "NASA GISS" ;
		:references = "TBD" ;
		:product_version = 1. ;
		:history = "TBD" ;
		:Conventions = "CF-1.8" ;
		:DOI = "https://doi.org/10.5281/zenodo.14020895" ;
}
#+end_example

